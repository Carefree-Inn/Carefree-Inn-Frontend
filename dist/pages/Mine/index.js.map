{"version":3,"file":"pages/Mine/index.js","sources":["webpack:///._src_pages_Mine_index.jsx","webpack:///._src_Images_avatar.png","webpack:///._src_Images_home.png","webpack:///._src_Images_like.png","webpack:///._src_Images_notif.png","webpack:///./src/pages/Mine/index.jsx?b918","webpack:///._src_pages_Mine_index.less"],"sourcesContent":["import Taro,{ usePullDownRefresh } from '@tarojs/taro'\nimport { useEffect, useState,useLayoutEffect } from 'react'\nimport { View, Text,Image } from '@tarojs/components'\nimport { getJson } from '../../Service/fetch'\nimport mine from '../../Images/avatar.png'\nimport home from '../../Images/home.png'\nimport like from '../../Images/like.png'\nimport notif from '../../Images/notif.png'\n/* import zan from '../../Images/zan.png'\nimport reply from '../../Images/reply.png' */\nimport './index.less'\n\n\nconst Mine=()=>{\n\n  const [name,setName] = useState('')\n  const [avatar,setAvatar] = useState('')\n  const [days,setDays] = useState()\n  const [socketOpen, setSocketOpen] = useState(false)\n  const [message,setMessage] = useState([])\n  const [read,setRead] = useState(false)//通知是否查看\n\n'\"{\"comment_id\":77,\"post_id\":4,\"to_user_account\":\"2021213975\",\"comment_time\":\"2023-06-28 15:54-48\",\"content\":\"我再回复一次你的评论\",\"from_user_account\":\"2021214115\",\"from_user_avatar\":\"http://qny.yyj-freshman-blog.xyz/FnSELjfIpMKxAiBFTJEG-lQdh4Yi\",\"from_user_nick_name\":\"hello\"}\"'\n  '\"{\"comment_id\":7,\"post_id\":7,\"to_user_account\":\"2021213975\",\"comment_time\":\"2023-06-27 15:03-17\",\"content\":\"真的很不错啊\",\"from_user_account\":\"2021213975\",\"from_user_avatar\":\"http://dummyimage.com/100x100\",\"from_user_nick_name\":\"2021213940\"}\"'\n  '\"{\"post_id\":15,\"to_user_account\":\"2021213975\",\"create_time\":\"2023-06-27 15:05:59\",\"like_type\":\"make\",\"from_user_account\":\"2021213975\",\"from_user_avatar\":\"http://dummyimage.com/100x100\",\"from_user_nickname\":\"2021213940\"}\"'\n\n  useLayoutEffect(()=>{\n    console.log('231')\n      getWebsocket()\n  },[])\n\n//连接websocket\n    function getWebsocket(){\n      Taro.connectSocket({\n        url: 'ws://139.196.30.123:8080/inn/api/v1/notification',\n        header:{\n          'content-type': 'application/json',\n          'Authorization':'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBY2NvdW50IjoiMjAyMTIxMzk3NSIsImV4cCI6MTY4ODQzMzMyMiwiaXNzIjoiQ0NOVS1Jbm4ifQ.HauJKVJhCLA0ha_yRvFyRxTSdQxU3QI36ew-ye7eQCA',\n        },\n       // protocols:[\"protocal1\"],\n        success: function () {\n          console.log('connect success')\n          Taro.onSocketOpen(()=>{\n            console.log('打开了')\n            setSocketOpen(true)\n            //Taro.onSocketMessage((msg)=>console.log(msg))\n          })\n        }\n      }).then(task => {\n        task.onOpen(function () {\n          console.log('onOpen')\n        })\n        task.onMessage(function (msg) {\n          //接受服务器消息\n          console.log('onMessage: ', msg)\n          const data = JSON.parse(msg.data)\n          console.log(data)\n          setMessage(message.concat(data))\n          //task.close()\n        })\n        task.onError(function () {\n          console.log('onError')\n          setSocketOpen(false)\n          reconnect()\n        })\n        task.onClose(function (e) {\n          console.log('onClose: ', e)\n          setSocketOpen(false)\n          reconnect()\n        })\n    })}\n\n    function reconnect(){\n      if(!socketOpen)\n        setSocketOpen(true)\n        setTimeout(function(){\n          getWebsocket();\n        },2000)\n    }\n\n\n  useEffect(()=>\n  {\n   \n    getJson('/user/profile',{})\n    .then(res=>{\n      setName(res.data.nickname)\n      setAvatar(res.data.avatar)\n      setDays(res.data.days)\n      console.log(res)\n  })},[])\n\n  usePullDownRefresh(() => {\n    getJson('/user/profile',{})\n    .then(res=>{\n      setName(res.data.nickname)\n      setAvatar(res.data.avatar)\n      setDays(res.data.days)\n     //console.log(res)\n  })\n  })\n\n\n  const  toMylike=()=>{\n    Taro.navigateTo({\n      url:'/moduleA/pages/Likepost/index'\n    })\n  }\n\n  const toHome=()=>{\n    Taro.navigateTo({\n      url:`/moduleA/pages/Homepage/index?avatar=${avatar}&name=${name}`\n    })\n  }\n\n  const toReply =()=>{\n    setRead(true)\n    Taro.navigateTo({\n      url:`/moduleA/pages/MyReply/index?message=${JSON.stringify({data:message})}`\n    })\n  }\n  return (\n\n    <>\n    <View className='Mine'>\n      <View className='user'>\n        <View className='left'>\n          <View className='u_name'>{name}</View>\n          <View className='join_time'>已加入{days}天</View>\n        </View>\n        <View className='right'>\n          <Image src={mine} ></Image>\n        </View>\n      </View>\n      <View className='Mine_box'>\n          <View className='item' >\n            <Image src={home}></Image>\n            <Text onClick={toHome}>我的主页 </Text></View>\n          <View className='item'>\n            <Image src={like}></Image>\n            <Text onClick={toMylike}>我喜欢的帖子</Text>\n            </View>\n          <View className='item'>\n            <Image src={notif}></Image>\n            <Text  onClick={toReply}>通知</Text>\n            {message.length==0 || read ?'':<View className='circle'>{message.length}</View>}\n          </View>\n      </View>\n    </View>\n    </>\n  )\n}\nexport default Mine;\n","module.exports = __webpack_public_path__ + \"Images/avatar.png\";","module.exports = __webpack_public_path__ + \"Images/home.png\";","module.exports = __webpack_public_path__ + \"Images/like.png\";","module.exports = __webpack_public_path__ + \"Images/notif.png\";","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../node_modules/babel-loader/lib/index.js!./index.jsx\"\nvar config = {\"navigationBarTitleText\":\"个人\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/Mine/index', {root:{cn:[]}}, config || {}))\n\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAGA;AAGA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;;;;;;;;;;;;ACxJA;;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;;;;A","sourceRoot":""}